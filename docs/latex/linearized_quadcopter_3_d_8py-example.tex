\hypertarget{linearized_quadcopter_3_d_8py-example}{}\section{linearized\+\_\+quadcopter\+\_\+3\+D.\+py}

\begin{DoxyCodeInclude}{0}
\end{DoxyCodeInclude}
 Example of how to setup two swarms in 3D. Both the agent and targets swarm are operating with a homogenous set of linearized quadcopter dynamic models with the linear quadratic regulator/tracker (L\+QR) controls. The agents are initialized in a uniform distribution, targets are in a fibonacci sphere and the terminal locations are in a circle


\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{1 }
\DoxyCodeLine{6 }
\DoxyCodeLine{7 \textcolor{keyword}{import} os.path}
\DoxyCodeLine{8 \textcolor{keyword}{import} sys}
\DoxyCodeLine{9 sys.path.append(os.path.join(os.path.dirname(\_\_file\_\_), \textcolor{stringliteral}{'..'}))}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{keyword}{import} os}
\DoxyCodeLine{12 \textcolor{keyword}{import} atexit}
\DoxyCodeLine{13 \textcolor{keyword}{from} time \textcolor{keyword}{import} time, strftime, localtime}
\DoxyCodeLine{14 \textcolor{keyword}{import} matplotlib.pyplot \textcolor{keyword}{as} plt}
\DoxyCodeLine{15 \textcolor{keyword}{from} datetime \textcolor{keyword}{import} timedelta, datetime}
\DoxyCodeLine{16 \textcolor{keyword}{import} numpy \textcolor{keyword}{as} np}
\DoxyCodeLine{17 \textcolor{keyword}{import} pandas \textcolor{keyword}{as} pd}
\DoxyCodeLine{18 }
\DoxyCodeLine{19 \textcolor{comment}{\# DOT\_assignment}}
\DoxyCodeLine{20 \textcolor{keyword}{from} \mbox{\hyperlink{namespace_d_o_t__assignment_1_1setup}{DOT\_assignment.setup}} \textcolor{keyword}{import} (setup\_simulation, generate\_initial\_conditions)}
\DoxyCodeLine{21 \textcolor{keyword}{from} DOT\_assignment.post\_process.post\_process \textcolor{keyword}{import} (}
\DoxyCodeLine{22         post\_process\_batch\_simulation,}
\DoxyCodeLine{23         post\_process\_batch\_diagnostics,}
\DoxyCodeLine{24         plot\_batch\_performance\_metrics,}
\DoxyCodeLine{25         plot\_batch\_diagnostics}
\DoxyCodeLine{26 )}
\DoxyCodeLine{27 \textcolor{keyword}{from} \mbox{\hyperlink{namespace_d_o_t__assignment_1_1log}{DOT\_assignment.log}} \textcolor{keyword}{import} (}
\DoxyCodeLine{28         save\_batch\_metrics\_to\_csv,}
\DoxyCodeLine{29         save\_batch\_diagnostics\_to\_csv,}
\DoxyCodeLine{30         save\_test\_info\_to\_txt}
\DoxyCodeLine{31 )}
\DoxyCodeLine{32 }
\DoxyCodeLine{33 }
\DoxyCodeLine{34 \textcolor{keyword}{def }get\_ensemble\_name(nensemble, dim, nagents, ntargets, agent\_model, target\_model, agent\_control\_policy, target\_control\_policy):}
\DoxyCodeLine{35 }
\DoxyCodeLine{36     \textcolor{stringliteral}{""" Returns ensemble name}}
\DoxyCodeLine{37 \textcolor{stringliteral}{}}
\DoxyCodeLine{38 \textcolor{stringliteral}{    """}}
\DoxyCodeLine{39 }
\DoxyCodeLine{40     identical = (agent\_model==target\_model)}
\DoxyCodeLine{41     \textcolor{keywordflow}{if} identical:}
\DoxyCodeLine{42         ensemble\_name = \textcolor{stringliteral}{'ensemble\_'} + str(nensemble) + \textcolor{stringliteral}{'\_'} + (str(dim) + \textcolor{stringliteral}{'D'}) + \textcolor{stringliteral}{'\_'} +\(\backslash\)}
\DoxyCodeLine{43                 str(nagents) + \textcolor{stringliteral}{'v'} + str(ntargets) + \textcolor{stringliteral}{'\_identical\_'} + agent\_model + \textcolor{stringliteral}{'\_'} + agent\_control\_policy + \textcolor{stringliteral}{'\_'} +\(\backslash\)}
\DoxyCodeLine{44                 target\_control\_policy + \textcolor{stringliteral}{'\_'} + datetime.now().strftime(\textcolor{stringliteral}{'\%Y\_\%m\_\%d\_\%H\_\%M\_\%S'})}
\DoxyCodeLine{45     \textcolor{keywordflow}{else}:}
\DoxyCodeLine{46         ensemble\_name = \textcolor{stringliteral}{'ensemble\_'} + str(nensemble) + \textcolor{stringliteral}{'\_'} + (str(dim) + \textcolor{stringliteral}{'D'}) + \(\backslash\)}
\DoxyCodeLine{47                 \textcolor{stringliteral}{'\_'} + str(nagents) + \textcolor{stringliteral}{'v'} + str(ntargets) + agent\_model + \textcolor{stringliteral}{'\_'} + target\_model + \textcolor{stringliteral}{'\_'} + agent\_control\_policy + \textcolor{stringliteral}{'\_'} +\(\backslash\)}
\DoxyCodeLine{48                 target\_control\_policy + \textcolor{stringliteral}{'\_'} + datetime.now().strftime(\textcolor{stringliteral}{'\%Y\_\%m\_\%d\_\%H\_\%M\_\%S'})}
\DoxyCodeLine{49 }
\DoxyCodeLine{50     \textcolor{keywordflow}{return} ensemble\_name}
\DoxyCodeLine{51 }
\DoxyCodeLine{52 \textcolor{keyword}{def }main():}
\DoxyCodeLine{53 }
\DoxyCodeLine{54     \textcolor{stringliteral}{""" Linearized quadcopter agent and target swarms in 3D}}
\DoxyCodeLine{55 \textcolor{stringliteral}{}}
\DoxyCodeLine{56 \textcolor{stringliteral}{    Setup ensemble, batch, and individual simulation parameters}}
\DoxyCodeLine{57 \textcolor{stringliteral}{    Create new directory to store ensemble, batch, and individual simulation results}}
\DoxyCodeLine{58 \textcolor{stringliteral}{    Call functions to perform simulations, pack results and diagnostics, and save to .csv}}
\DoxyCodeLine{59 \textcolor{stringliteral}{}}
\DoxyCodeLine{60 \textcolor{stringliteral}{    \#\#\#\#\#\#\# INFO \#\#\#\#\#\#}}
\DoxyCodeLine{61 \textcolor{stringliteral}{    \# simulation: set of initial conditions with 1 asst pol}}
\DoxyCodeLine{62 \textcolor{stringliteral}{    \# batch\_simulation: set of simulations with SAME initial conditions}}
\DoxyCodeLine{63 \textcolor{stringliteral}{    \# ensemble\_simulation: set of different batch simulations}}
\DoxyCodeLine{64 \textcolor{stringliteral}{}}
\DoxyCodeLine{65 \textcolor{stringliteral}{    \# ex. ic\_i = ith initial\_conditions}}
\DoxyCodeLine{66 \textcolor{stringliteral}{    \# sim1 = ic\_1 and EMD}}
\DoxyCodeLine{67 \textcolor{stringliteral}{    \# sim2 = ic\_1 and DYN}}
\DoxyCodeLine{68 \textcolor{stringliteral}{    \# batch\_1 = [sim1, sim2] = [ic\_1 and EMD, ic\_1 and DYN]}}
\DoxyCodeLine{69 \textcolor{stringliteral}{    \# sim3 = ic\_2 and EMD}}
\DoxyCodeLine{70 \textcolor{stringliteral}{    \# sim4 = ic\_2 and DYN}}
\DoxyCodeLine{71 \textcolor{stringliteral}{    \# batch\_2 = [sim3, sim4] = [ic\_2 and EMD, ic\_2 and DYN]}}
\DoxyCodeLine{72 \textcolor{stringliteral}{    \# ensemble\_1 = [batch\_1, batch\_2] = [ [sim1, sim2], [sim3, sim4] ]}}
\DoxyCodeLine{73 \textcolor{stringliteral}{    \#            = [ [ic\_1 and EMD, ic\_1 and DYN], [ic\_2 and EMD, ic\_2 and DYN] ]}}
\DoxyCodeLine{74 \textcolor{stringliteral}{}}
\DoxyCodeLine{75 \textcolor{stringliteral}{    """}}
\DoxyCodeLine{76 }
\DoxyCodeLine{77     ensemble\_simulation = []}
\DoxyCodeLine{78     batch\_simulation = []}
\DoxyCodeLine{79     nbatches = 1}
\DoxyCodeLine{80 }
\DoxyCodeLine{81     }
\DoxyCodeLine{83     dt = 0.01}
\DoxyCodeLine{84     maxtime = 5}
\DoxyCodeLine{85     dim = 3}
\DoxyCodeLine{86     nagents = 2}
\DoxyCodeLine{87     ntargets = 2}
\DoxyCodeLine{88     agent\_model = \textcolor{stringliteral}{"Linearized\_Quadcopter"}}
\DoxyCodeLine{89     target\_model = \textcolor{stringliteral}{"Linearized\_Quadcopter"}}
\DoxyCodeLine{90     collisions = \textcolor{keyword}{True}}
\DoxyCodeLine{91     collision\_tol = 1e-2}
\DoxyCodeLine{92     agent\_control\_policy = \textcolor{stringliteral}{"LQR"}}
\DoxyCodeLine{93     target\_control\_policy = \textcolor{stringliteral}{"LQR"}}
\DoxyCodeLine{94     assignment\_epoch = 10}
\DoxyCodeLine{95     }
\DoxyCodeLine{96 }
\DoxyCodeLine{97     \textcolor{comment}{\# Create directory for storage}}
\DoxyCodeLine{98     nensemble = 0}
\DoxyCodeLine{99 }
\DoxyCodeLine{100     \textcolor{comment}{\# TODO ensemble should not default to 'identical'}}
\DoxyCodeLine{101     ensemble\_name = get\_ensemble\_name(nensemble, dim, nagents, ntargets, agent\_model, target\_model, agent\_control\_policy, target\_control\_policy)}
\DoxyCodeLine{102 }
\DoxyCodeLine{103     root\_directory = \textcolor{stringliteral}{'./'}}
\DoxyCodeLine{104     ensemble\_directory = root\_directory + ensemble\_name}
\DoxyCodeLine{105 }
\DoxyCodeLine{106     \textcolor{comment}{\# create directory to store ensemble}}
\DoxyCodeLine{107     \textcolor{keywordflow}{try}:}
\DoxyCodeLine{108         os.makedirs(ensemble\_directory)}
\DoxyCodeLine{109     \textcolor{keywordflow}{except} FileExistsError:}
\DoxyCodeLine{110         \textcolor{comment}{\# directory already exists}}
\DoxyCodeLine{111         \textcolor{keywordflow}{pass}}
\DoxyCodeLine{112 }
\DoxyCodeLine{113     \textcolor{comment}{\# TODO assumes heterogeneous swarms}}
\DoxyCodeLine{114     \textcolor{comment}{\# formations: uniform\_distribution, circle, fibonacci\_sphere}}
\DoxyCodeLine{115     initial\_formation\_params = \{}
\DoxyCodeLine{116             \textcolor{stringliteral}{'nagents'}: nagents, \textcolor{stringliteral}{'agent\_model'}: agent\_model, \textcolor{stringliteral}{'agent\_swarm\_formation'}: \textcolor{stringliteral}{'uniform\_distribution'},}
\DoxyCodeLine{117             \textcolor{stringliteral}{'ntargets'}: ntargets, \textcolor{stringliteral}{'target\_model'}: target\_model, \textcolor{stringliteral}{'target\_swarm\_formation'}: \textcolor{stringliteral}{'fibonacci\_sphere'},}
\DoxyCodeLine{118             \textcolor{stringliteral}{'nstationary\_states'}: ntargets, \textcolor{stringliteral}{'stationary\_states\_formation'}: \textcolor{stringliteral}{'circle'}}
\DoxyCodeLine{119             \}}
\DoxyCodeLine{120 }
\DoxyCodeLine{121     \textcolor{comment}{\# CONSTRUCT ENSEMBLE OF SIMULATIONS}}
\DoxyCodeLine{122     \textcolor{keywordflow}{for} batch\_i \textcolor{keywordflow}{in} range(nbatches):}
\DoxyCodeLine{123 }
\DoxyCodeLine{124         \textcolor{comment}{\# Create a batch of simulations (ie. group of sim with same initial state conditions)}}
\DoxyCodeLine{125         batch = \{\}}
\DoxyCodeLine{126 }
\DoxyCodeLine{127         \textcolor{comment}{\# SIM SETUP}}
\DoxyCodeLine{128 }
\DoxyCodeLine{129         initial\_conditions = generate\_initial\_conditions(dim, initial\_formation\_params)}
\DoxyCodeLine{130 }
\DoxyCodeLine{131         }
\DoxyCodeLine{132         sim\_profiles = \{\}}
\DoxyCodeLine{133 }
\DoxyCodeLine{134         \textcolor{comment}{\# EMD parameters}}
\DoxyCodeLine{135         dt = dt}
\DoxyCodeLine{136         asst = \textcolor{stringliteral}{'AssignmentEMD'}}
\DoxyCodeLine{137         sim\_profile\_name = \textcolor{stringliteral}{'emd'}}
\DoxyCodeLine{138         sim\_profiles.update(\{sim\_profile\_name: \{\textcolor{stringliteral}{'agent\_model'}: agent\_model, \textcolor{stringliteral}{'target\_model'}: target\_model,}
\DoxyCodeLine{139             \textcolor{stringliteral}{'agent\_control\_policy'}: agent\_control\_policy, \textcolor{stringliteral}{'target\_control\_policy'}: target\_control\_policy,}
\DoxyCodeLine{140             \textcolor{stringliteral}{'assignment\_policy'}: asst, \textcolor{stringliteral}{'assignment\_epoch'}: assignment\_epoch, \textcolor{stringliteral}{'nagents'}: nagents, \textcolor{stringliteral}{'ntargets'}: ntargets,}
\DoxyCodeLine{141             \textcolor{stringliteral}{'collisions'}: collisions, \textcolor{stringliteral}{'collision\_tol'}: collision\_tol, \textcolor{stringliteral}{'dim'}: dim, \textcolor{stringliteral}{'dt'}: dt, \textcolor{stringliteral}{'maxtime'}: maxtime, \textcolor{stringliteral}{'initial\_conditions'}: initial\_conditions\}\})}
\DoxyCodeLine{142 }
\DoxyCodeLine{143         \textcolor{comment}{\# DYN parameters}}
\DoxyCodeLine{144         dt = dt}
\DoxyCodeLine{145         asst = \textcolor{stringliteral}{'AssignmentDyn'}}
\DoxyCodeLine{146         sim\_profile\_name = \textcolor{stringliteral}{'dyn'}}
\DoxyCodeLine{147         sim\_profiles.update(\{sim\_profile\_name: \{\textcolor{stringliteral}{'agent\_model'}: agent\_model, \textcolor{stringliteral}{'target\_model'}: target\_model,}
\DoxyCodeLine{148             \textcolor{stringliteral}{'agent\_control\_policy'}: agent\_control\_policy, \textcolor{stringliteral}{'target\_control\_policy'}: target\_control\_policy,}
\DoxyCodeLine{149             \textcolor{stringliteral}{'assignment\_policy'}: asst, \textcolor{stringliteral}{'assignment\_epoch'}: assignment\_epoch, \textcolor{stringliteral}{'nagents'}: nagents, \textcolor{stringliteral}{'ntargets'}: ntargets,}
\DoxyCodeLine{150             \textcolor{stringliteral}{'collisions'}: collisions, \textcolor{stringliteral}{'collision\_tol'}: collision\_tol, \textcolor{stringliteral}{'dim'}: dim, \textcolor{stringliteral}{'dt'}: dt, \textcolor{stringliteral}{'maxtime'}: maxtime, \textcolor{stringliteral}{'initial\_conditions'}: initial\_conditions\}\})}
\DoxyCodeLine{151 }
\DoxyCodeLine{152         }
\DoxyCodeLine{153 }
\DoxyCodeLine{154         \textcolor{keywordflow}{for} profile\_name, profile \textcolor{keywordflow}{in} sim\_profiles.items():}
\DoxyCodeLine{155             sim = setup\_simulation(profile)}
\DoxyCodeLine{156             sim\_name = sim[\textcolor{stringliteral}{'asst\_pol'}].\_\_class\_\_.\_\_name\_\_}
\DoxyCodeLine{157             batch.update(\{sim\_name: sim\})}
\DoxyCodeLine{158 }
\DoxyCodeLine{159         \textcolor{comment}{\# add batch to ensemble}}
\DoxyCodeLine{160         ensemble\_simulation.append(batch)}
\DoxyCodeLine{161 }
\DoxyCodeLine{162     \textcolor{comment}{\# TODO separate functions?}}
\DoxyCodeLine{163     \textcolor{comment}{\# RUN SIMULATION}}
\DoxyCodeLine{164     ensemble\_results = \{\}}
\DoxyCodeLine{165     \textcolor{keywordflow}{for} ii, batch \textcolor{keywordflow}{in} enumerate(ensemble\_simulation):}
\DoxyCodeLine{166 }
\DoxyCodeLine{167         batch\_name = \textcolor{stringliteral}{'batch\_\{0\}'}.format(ii)}
\DoxyCodeLine{168         batch\_results = \{\}}
\DoxyCodeLine{169         batch\_diagnostics = \{\}}
\DoxyCodeLine{170 }
\DoxyCodeLine{171         \textcolor{keywordflow}{for} sim\_name, sim \textcolor{keywordflow}{in} batch.items():}
\DoxyCodeLine{172 }
\DoxyCodeLine{173             \textcolor{comment}{\# TODO not the same order for heterogeneous and non-identical}}
\DoxyCodeLine{174             \textcolor{comment}{\# Simulation data structures}}
\DoxyCodeLine{175             collisions = sim[\textcolor{stringliteral}{"collisions"}]}
\DoxyCodeLine{176             collision\_tol = sim[\textcolor{stringliteral}{"collision\_tol"}]}
\DoxyCodeLine{177             dt = sim[\textcolor{stringliteral}{"dt"}]}
\DoxyCodeLine{178             maxtime = sim[\textcolor{stringliteral}{"maxtime"}]}
\DoxyCodeLine{179             dx = sim[\textcolor{stringliteral}{"dx"}]}
\DoxyCodeLine{180             du = sim[\textcolor{stringliteral}{"du"}]}
\DoxyCodeLine{181             statespace = sim[\textcolor{stringliteral}{"statespace"}]}
\DoxyCodeLine{182             x0 = sim[\textcolor{stringliteral}{"x0"}]}
\DoxyCodeLine{183             ltidyn = sim[\textcolor{stringliteral}{"agent\_dyn"}]}
\DoxyCodeLine{184             target\_dyn = sim[\textcolor{stringliteral}{"target\_dyns"}]}
\DoxyCodeLine{185             poltrack = sim[\textcolor{stringliteral}{"agent\_pol"}]}
\DoxyCodeLine{186             poltargets = sim[\textcolor{stringliteral}{"target\_pol"}]}
\DoxyCodeLine{187             assignment\_pol = sim[\textcolor{stringliteral}{"asst\_pol"}]}
\DoxyCodeLine{188             assignment\_epoch = sim[\textcolor{stringliteral}{"asst\_epoch"}]}
\DoxyCodeLine{189             nagents = sim[\textcolor{stringliteral}{"nagents"}]}
\DoxyCodeLine{190             ntargets = sim[\textcolor{stringliteral}{"ntargets"}]}
\DoxyCodeLine{191             runner = sim[\textcolor{stringliteral}{"runner"}]}
\DoxyCodeLine{192 }
\DoxyCodeLine{193             \textcolor{comment}{\# Other simulation information}}
\DoxyCodeLine{194             agent\_model = sim[\textcolor{stringliteral}{"agent\_model"}]}
\DoxyCodeLine{195             target\_model = sim[\textcolor{stringliteral}{"target\_model"}]}
\DoxyCodeLine{196             agent\_control\_policy = sim[\textcolor{stringliteral}{"agent\_control\_policy"}]}
\DoxyCodeLine{197             target\_control\_policy = sim[\textcolor{stringliteral}{"target\_control\_policy"}]}
\DoxyCodeLine{198 }
\DoxyCodeLine{199             \textcolor{comment}{\# run simulation}}
\DoxyCodeLine{200             results, diagnostics = runner(}
\DoxyCodeLine{201                 dx,}
\DoxyCodeLine{202                 du,}
\DoxyCodeLine{203                 statespace,}
\DoxyCodeLine{204                 x0,}
\DoxyCodeLine{205                 ltidyn,}
\DoxyCodeLine{206                 target\_dyn,}
\DoxyCodeLine{207                 poltrack,}
\DoxyCodeLine{208                 poltargets,}
\DoxyCodeLine{209                 assignment\_pol,}
\DoxyCodeLine{210                 assignment\_epoch,}
\DoxyCodeLine{211                 nagents,}
\DoxyCodeLine{212                 ntargets,}
\DoxyCodeLine{213                 collisions,}
\DoxyCodeLine{214                 collision\_tol,}
\DoxyCodeLine{215                 dt,}
\DoxyCodeLine{216                 maxtime,}
\DoxyCodeLine{217             )}
\DoxyCodeLine{218 }
\DoxyCodeLine{219             \textcolor{comment}{\# results components}}
\DoxyCodeLine{220             components = [}
\DoxyCodeLine{221                 \textcolor{stringliteral}{"agents"},}
\DoxyCodeLine{222                 \textcolor{stringliteral}{"targets"},}
\DoxyCodeLine{223                 \textcolor{stringliteral}{"data"},}
\DoxyCodeLine{224                 \textcolor{stringliteral}{"tracking\_policy"},}
\DoxyCodeLine{225                 \textcolor{stringliteral}{"target\_pol"},}
\DoxyCodeLine{226                 \textcolor{stringliteral}{"nagents"},}
\DoxyCodeLine{227                 \textcolor{stringliteral}{"ntargets"},}
\DoxyCodeLine{228                 \textcolor{stringliteral}{"asst\_cost"},}
\DoxyCodeLine{229                 \textcolor{stringliteral}{"agent\_pol"},}
\DoxyCodeLine{230                 \textcolor{stringliteral}{"optimal\_asst"},}
\DoxyCodeLine{231                 \textcolor{stringliteral}{"asst\_policy"},}
\DoxyCodeLine{232             ]}
\DoxyCodeLine{233 }
\DoxyCodeLine{234             \textcolor{comment}{\# diagnostics components}}
\DoxyCodeLine{235             diag\_components = [}
\DoxyCodeLine{236                     \textcolor{stringliteral}{"runtime\_diagnostics"}}
\DoxyCodeLine{237                     ]}
\DoxyCodeLine{238 }
\DoxyCodeLine{239             \textcolor{comment}{\# organize simulation parameters}}
\DoxyCodeLine{240             sim\_parameters = \{}
\DoxyCodeLine{241                 \textcolor{stringliteral}{"dt"}: dt,}
\DoxyCodeLine{242                 \textcolor{stringliteral}{"dim"}: dim,}
\DoxyCodeLine{243                 \textcolor{stringliteral}{"dx"}: dx,}
\DoxyCodeLine{244                 \textcolor{stringliteral}{"du"}: du,}
\DoxyCodeLine{245                 \textcolor{stringliteral}{"statespace"}: statespace,}
\DoxyCodeLine{246                 \textcolor{stringliteral}{"agent\_model"}: agent\_model,}
\DoxyCodeLine{247                 \textcolor{stringliteral}{"target\_model"}: target\_model,}
\DoxyCodeLine{248                 \textcolor{stringliteral}{"agent\_control\_policy"}: agent\_control\_policy,}
\DoxyCodeLine{249                 \textcolor{stringliteral}{"target\_control\_policy"}: target\_control\_policy,}
\DoxyCodeLine{250                 \textcolor{stringliteral}{"collisions"}: collisions,}
\DoxyCodeLine{251                 \textcolor{stringliteral}{"collision\_tol"}: collision\_tol,}
\DoxyCodeLine{252                 \textcolor{stringliteral}{"assignment\_epoch"}: assignment\_epoch}
\DoxyCodeLine{253             \}}
\DoxyCodeLine{254 }
\DoxyCodeLine{255             \textcolor{comment}{\# organize results according to components}}
\DoxyCodeLine{256             sim\_results = \{\}}
\DoxyCodeLine{257             \textcolor{keywordflow}{for} (comp, res) \textcolor{keywordflow}{in} zip(components, results):}
\DoxyCodeLine{258                 sim\_results.update(\{comp: res\})}
\DoxyCodeLine{259 }
\DoxyCodeLine{260             \textcolor{comment}{\# organize diagnostics}}
\DoxyCodeLine{261             sim\_diagnostics = \{\}}
\DoxyCodeLine{262             \textcolor{keywordflow}{for} (diag\_comp, diag) \textcolor{keywordflow}{in} zip(diag\_components, diagnostics):}
\DoxyCodeLine{263                 sim\_diagnostics.update(\{diag\_comp: diag\})}
\DoxyCodeLine{264 }
\DoxyCodeLine{265             \textcolor{comment}{\# store sim results into a batch}}
\DoxyCodeLine{266             batch\_results.update(\{sim\_name: [sim\_parameters, sim\_results]\}) \textcolor{comment}{\# dict}}
\DoxyCodeLine{267 }
\DoxyCodeLine{268             \textcolor{comment}{\# store sim diagnostics into a batch}}
\DoxyCodeLine{269             batch\_diagnostics.update(\{sim\_name: [sim\_parameters, sim\_diagnostics]\}) \textcolor{comment}{\# dict}}
\DoxyCodeLine{270 }
\DoxyCodeLine{271         \textcolor{comment}{\# post-process and save}}
\DoxyCodeLine{272         batch\_performance\_metrics = post\_process\_batch\_simulation(batch\_results) \textcolor{comment}{\# returns dict}}
\DoxyCodeLine{273         \textcolor{comment}{\# collect diagnostics}}
\DoxyCodeLine{274         packed\_batch\_diagnostics = post\_process\_batch\_diagnostics(batch\_diagnostics) \textcolor{comment}{\# returns dict}}
\DoxyCodeLine{275 }
\DoxyCodeLine{276         \textcolor{comment}{\# \# DEBUG}}
\DoxyCodeLine{277         \textcolor{comment}{\# plot\_batch\_performance\_metrics(batch\_performance\_metrics)}}
\DoxyCodeLine{278         \textcolor{comment}{\# plot\_batch\_diagnostics(packed\_batch\_diagnostics)}}
\DoxyCodeLine{279         \textcolor{comment}{\# plt.show()}}
\DoxyCodeLine{280 }
\DoxyCodeLine{281         save\_batch\_metrics\_to\_csv(batch\_performance\_metrics, ensemble\_directory, batch\_name)}
\DoxyCodeLine{282         save\_batch\_diagnostics\_to\_csv(packed\_batch\_diagnostics, ensemble\_directory, batch\_name)}
\DoxyCodeLine{283 }
\DoxyCodeLine{284         \textcolor{comment}{\# store batch results (useful for saving multiple ensembles)}}
\DoxyCodeLine{285         \textcolor{comment}{\# ensemble\_results.update(\{batch\_name: batch\_results\})}}
\DoxyCodeLine{286 }
\DoxyCodeLine{287     test\_conditions = \{\textcolor{stringliteral}{'nbatches'}: nbatches, \textcolor{stringliteral}{'default\_dt'}: dt, \textcolor{stringliteral}{'maxtime'}: maxtime, \textcolor{stringliteral}{'dim'}: dim, \textcolor{stringliteral}{'nagents'}: nagents, \textcolor{stringliteral}{'ntargets'}: ntargets, \textcolor{stringliteral}{'agent\_model'}: agent\_model, \textcolor{stringliteral}{'target\_model'}: target\_model, \textcolor{stringliteral}{'collisions'}: collisions, \textcolor{stringliteral}{'collision\_tol'}: collision\_tol, \textcolor{stringliteral}{'agent\_control\_policy'}: agent\_control\_policy, \textcolor{stringliteral}{'target\_control\_policy'}: target\_control\_policy, \textcolor{stringliteral}{'assignment\_epoch'}: assignment\_epoch, \textcolor{stringliteral}{'ensemble\_name'}: ensemble\_name, \textcolor{stringliteral}{'ensemble\_directory'}: ensemble\_directory\}}
\DoxyCodeLine{288 }
\DoxyCodeLine{289     print(\textcolor{stringliteral}{"done!"})}
\DoxyCodeLine{290 }
\DoxyCodeLine{291     \textcolor{keywordflow}{return} test\_conditions}
\DoxyCodeLine{292 }
\DoxyCodeLine{293 \textcolor{keyword}{def }secondsToStr(elapsed=None):}
\DoxyCodeLine{294 }
\DoxyCodeLine{295     \textcolor{stringliteral}{""" Converts seconds to strings}}
\DoxyCodeLine{296 \textcolor{stringliteral}{}}
\DoxyCodeLine{297 \textcolor{stringliteral}{    """}}
\DoxyCodeLine{298 }
\DoxyCodeLine{299     \textcolor{keywordflow}{if} elapsed \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:}
\DoxyCodeLine{300         \textcolor{keywordflow}{return} strftime(\textcolor{stringliteral}{"\%Y-\%m-\%d \%H:\%M:\%S"}, localtime())}
\DoxyCodeLine{301     \textcolor{keywordflow}{else}:}
\DoxyCodeLine{302         \textcolor{keywordflow}{return} str(timedelta(seconds=elapsed))}
\DoxyCodeLine{303 }
\DoxyCodeLine{304 \textcolor{keyword}{def }log(s, elapsed=None):}
\DoxyCodeLine{305 }
\DoxyCodeLine{306     \textcolor{stringliteral}{""" start logging of elapsed time}}
\DoxyCodeLine{307 \textcolor{stringliteral}{}}
\DoxyCodeLine{308 \textcolor{stringliteral}{    """}}
\DoxyCodeLine{309 }
\DoxyCodeLine{310     line = \textcolor{stringliteral}{"="}*40}
\DoxyCodeLine{311     print(line)}
\DoxyCodeLine{312     print(secondsToStr(), \textcolor{stringliteral}{'-'}, s)}
\DoxyCodeLine{313     ss = secondsToStr() + \textcolor{stringliteral}{' - '} + s}
\DoxyCodeLine{314     \textcolor{keywordflow}{if} elapsed:}
\DoxyCodeLine{315         print(\textcolor{stringliteral}{"Elapsed time:"}, elapsed)}
\DoxyCodeLine{316     print(line)}
\DoxyCodeLine{317     print()}
\DoxyCodeLine{318     \textcolor{keywordflow}{return} ss}
\DoxyCodeLine{319 }
\DoxyCodeLine{320 \textcolor{keyword}{def }endlog():}
\DoxyCodeLine{321 }
\DoxyCodeLine{322     \textcolor{stringliteral}{""" end log of elapsed time}}
\DoxyCodeLine{323 \textcolor{stringliteral}{}}
\DoxyCodeLine{324 \textcolor{stringliteral}{    """}}
\DoxyCodeLine{325 }
\DoxyCodeLine{326     end = time()}
\DoxyCodeLine{327     elapsed = end-start}
\DoxyCodeLine{328     log(\textcolor{stringliteral}{"End Program"}, secondsToStr(elapsed))}
\DoxyCodeLine{329 }
\DoxyCodeLine{330 }
\DoxyCodeLine{331 \textcolor{keywordflow}{if} \_\_name\_\_ == \textcolor{stringliteral}{"\_\_main\_\_"}:}
\DoxyCodeLine{332 }
\DoxyCodeLine{333     start = time()}
\DoxyCodeLine{334     \textcolor{comment}{\# atexit.register(endlog) \# print end time at program termination}}
\DoxyCodeLine{335     starttime = log(\textcolor{stringliteral}{"Start Program"})}
\DoxyCodeLine{336 }
\DoxyCodeLine{337     \textcolor{comment}{\# PERFORM TEST}}
\DoxyCodeLine{338     test\_conditions = main()}
\DoxyCodeLine{339 }
\DoxyCodeLine{340     ensemble\_name = test\_conditions[\textcolor{stringliteral}{'ensemble\_name'}]}
\DoxyCodeLine{341     ensemble\_directory = test\_conditions[\textcolor{stringliteral}{'ensemble\_directory'}]}
\DoxyCodeLine{342 }
\DoxyCodeLine{343     \textcolor{comment}{\# PRINT TEST INFO TO TERMINAL}}
\DoxyCodeLine{344     print()}
\DoxyCodeLine{345     line = \textcolor{stringliteral}{"*"}*40}
\DoxyCodeLine{346     print(line)}
\DoxyCodeLine{347     \textcolor{keywordflow}{for} condition, value \textcolor{keywordflow}{in} test\_conditions.items():}
\DoxyCodeLine{348         print(condition, \textcolor{stringliteral}{': '}, value)}
\DoxyCodeLine{349     print(line)}
\DoxyCodeLine{350     print()}
\DoxyCodeLine{351 }
\DoxyCodeLine{352     \textcolor{comment}{\# display starttime at the end as well as beginning}}
\DoxyCodeLine{353     line = \textcolor{stringliteral}{"="}*40}
\DoxyCodeLine{354     print(line)}
\DoxyCodeLine{355     print(starttime)}
\DoxyCodeLine{356     print(line)}
\DoxyCodeLine{357     print()}
\DoxyCodeLine{358 }
\DoxyCodeLine{359     end = time() \textcolor{comment}{\# print end time at end of simulation}}
\DoxyCodeLine{360     elapsed = end-start}
\DoxyCodeLine{361     elapsedstr = secondsToStr(elapsed)}
\DoxyCodeLine{362     endtime = log(\textcolor{stringliteral}{"End Program"}, elapsedstr)}
\DoxyCodeLine{363 }
\DoxyCodeLine{364     save\_test\_info\_to\_txt(ensemble\_name, test\_conditions, ensemble\_directory, starttime, endtime, elapsedstr)}
\DoxyCodeLine{365 }
\end{DoxyCodeInclude}
 